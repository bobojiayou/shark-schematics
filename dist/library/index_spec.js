"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
const testing_1 = require("@angular-devkit/schematics/testing");
const path = require("path");
const latest_versions_1 = require("../utility/latest-versions");
function getJsonFileContent(tree, path) {
    return JSON.parse(tree.readContent(path));
}
// tslint:disable:max-line-length
describe('Library Schematic', () => {
    const schematicRunner = new testing_1.SchematicTestRunner('@schematics/ng_packagr', path.join(__dirname, '../collection.json'));
    const defaultOptions = {
        name: 'foo',
        entryFile: 'my_index',
        skipPackageJson: false,
        skipTsConfig: false,
    };
    const workspaceOptions = {
        name: 'workspace',
        newProjectRoot: 'projects',
        version: '6.0.0',
    };
    let workspaceTree;
    beforeEach(() => {
        workspaceTree = schematicRunner.runSchematic('workspace', workspaceOptions);
    });
    it('should create files', () => {
        const tree = schematicRunner.runSchematic('library', defaultOptions, workspaceTree);
        const files = tree.files;
        expect(files.indexOf('/projects/foo/karma.conf.js')).toBeGreaterThanOrEqual(0);
        expect(files.indexOf('/projects/foo/ng-package.json')).toBeGreaterThanOrEqual(0);
        expect(files.indexOf('/projects/foo/package.json')).toBeGreaterThanOrEqual(0);
        expect(files.indexOf('/projects/foo/tslint.json')).toBeGreaterThanOrEqual(0);
        expect(files.indexOf('/projects/foo/src/test.ts')).toBeGreaterThanOrEqual(0);
        expect(files.indexOf('/projects/foo/src/my_index.ts')).toBeGreaterThanOrEqual(0);
        expect(files.indexOf('/projects/foo/src/lib/foo.module.ts')).toBeGreaterThanOrEqual(0);
        expect(files.indexOf('/projects/foo/src/lib/foo.component.spec.ts')).toBeGreaterThanOrEqual(0);
        expect(files.indexOf('/projects/foo/src/lib/foo.component.ts')).toBeGreaterThanOrEqual(0);
        expect(files.indexOf('/projects/foo/src/lib/foo.service.spec.ts')).toBeGreaterThanOrEqual(0);
        expect(files.indexOf('/projects/foo/src/lib/foo.service.ts')).toBeGreaterThanOrEqual(0);
    });
    it('should create a tsconfig for library', () => {
        const tree = schematicRunner.runSchematic('library', defaultOptions, workspaceTree);
        const fileContent = getJsonFileContent(tree, '/projects/foo/tsconfig.lib.json');
        expect(fileContent).toBeDefined();
    });
    it('should create a ng-package.json with ngPackage conf', () => {
        const tree = schematicRunner.runSchematic('library', defaultOptions, workspaceTree);
        const fileContent = getJsonFileContent(tree, '/projects/foo/ng-package.json');
        expect(fileContent.lib).toBeDefined();
        expect(fileContent.lib.entryFile).toEqual('src/my_index.ts');
        expect(fileContent.deleteDestPath).toEqual(false);
        expect(fileContent.dest).toEqual('../../dist/foo');
    });
    it('should use default value for baseDir and entryFile', () => {
        const tree = schematicRunner.runSchematic('library', {
            name: 'foobar',
        }, workspaceTree);
        expect(tree.files.indexOf('/projects/foobar/src/public_api.ts')).toBeGreaterThanOrEqual(0);
    });
    it(`should add library to workspace`, () => {
        const tree = schematicRunner.runSchematic('library', defaultOptions, workspaceTree);
        const workspace = getJsonFileContent(tree, '/angular.json');
        expect(workspace.projects.foo).toBeDefined();
        expect(workspace.defaultProject).toBe('foo');
    });
    it('should set the prefix to lib if none is set', () => {
        const tree = schematicRunner.runSchematic('library', defaultOptions, workspaceTree);
        const workspace = JSON.parse(tree.readContent('/angular.json'));
        expect(workspace.projects.foo.prefix).toEqual('lib');
    });
    it('should set the prefix correctly', () => {
        const options = Object.assign({}, defaultOptions, { prefix: 'pre' });
        const tree = schematicRunner.runSchematic('library', options, workspaceTree);
        const workspace = JSON.parse(tree.readContent('/angular.json'));
        expect(workspace.projects.foo.prefix).toEqual('pre');
    });
    it('should handle a pascalCasedName', () => {
        const options = Object.assign({}, defaultOptions, { name: 'pascalCasedName' });
        const tree = schematicRunner.runSchematic('library', options, workspaceTree);
        const config = getJsonFileContent(tree, '/angular.json');
        const project = config.projects.pascalCasedName;
        expect(project).toBeDefined();
        expect(project.root).toEqual('projects/pascal-cased-name');
        const svcContent = tree.readContent('/projects/pascal-cased-name/src/lib/pascal-cased-name.service.ts');
        expect(svcContent).toMatch(/providedIn: 'root'/);
    });
    it('should set the right path and prefix in the tslint file', () => {
        const tree = schematicRunner.runSchematic('library', defaultOptions, workspaceTree);
        const path = '/projects/foo/tslint.json';
        const content = JSON.parse(tree.readContent(path));
        expect(content.extends).toMatch('../../tslint.json');
        expect(content.rules['directive-selector'][2]).toMatch('lib');
        expect(content.rules['component-selector'][2]).toMatch('lib');
    });
    describe(`update package.json`, () => {
        it(`should add ng-packagr to devDependencies`, () => {
            const tree = schematicRunner.runSchematic('library', defaultOptions, workspaceTree);
            const packageJson = getJsonFileContent(tree, 'package.json');
            expect(packageJson.devDependencies['ng-packagr']).toEqual('^3.0.0');
            expect(packageJson.devDependencies['@angular-devkit/build-ng-packagr'])
                .toEqual(latest_versions_1.latestVersions.DevkitBuildNgPackagr);
        });
        it('should use the latest known versions in package.json', () => {
            const tree = schematicRunner.runSchematic('library', defaultOptions, workspaceTree);
            const pkg = JSON.parse(tree.readContent('/package.json'));
            expect(pkg.devDependencies['@angular/compiler-cli']).toEqual(latest_versions_1.latestVersions.Angular);
            expect(pkg.devDependencies['typescript']).toEqual(latest_versions_1.latestVersions.TypeScript);
        });
        it(`should not override existing users dependencies`, () => {
            const oldPackageJson = workspaceTree.readContent('package.json');
            workspaceTree.overwrite('package.json', oldPackageJson.replace(`"typescript": "${latest_versions_1.latestVersions.TypeScript}"`, `"typescript": "~2.5.2"`));
            const tree = schematicRunner.runSchematic('library', defaultOptions, workspaceTree);
            const packageJson = getJsonFileContent(tree, 'package.json');
            expect(packageJson.devDependencies.typescript).toEqual('~2.5.2');
        });
        it(`should not modify the file when --skipPackageJson`, () => {
            const tree = schematicRunner.runSchematic('library', {
                name: 'foo',
                skipPackageJson: true,
            }, workspaceTree);
            const packageJson = getJsonFileContent(tree, 'package.json');
            expect(packageJson.devDependencies['ng-packagr']).toBeUndefined();
            expect(packageJson.devDependencies['@angular-devkit/build-angular']).toBeUndefined();
        });
    });
    describe(`update tsconfig.json`, () => {
        it(`should add paths mapping to empty tsconfig`, () => {
            const tree = schematicRunner.runSchematic('library', defaultOptions, workspaceTree);
            const tsConfigJson = getJsonFileContent(tree, 'tsconfig.json');
            expect(tsConfigJson.compilerOptions.paths.foo).toBeTruthy();
            expect(tsConfigJson.compilerOptions.paths.foo.length).toEqual(1);
            expect(tsConfigJson.compilerOptions.paths.foo[0]).toEqual('dist/foo');
            expect(tsConfigJson.compilerOptions.paths['foo/*']).toBeTruthy();
            expect(tsConfigJson.compilerOptions.paths['foo/*'].length).toEqual(1);
            expect(tsConfigJson.compilerOptions.paths['foo/*'][0]).toEqual('dist/foo/*');
        });
        it(`should append to existing paths mappings`, () => {
            workspaceTree.overwrite('tsconfig.json', JSON.stringify({
                compilerOptions: {
                    paths: {
                        'unrelated': ['./something/else.ts'],
                        'foo': ['libs/*'],
                    },
                },
            }));
            const tree = schematicRunner.runSchematic('library', defaultOptions, workspaceTree);
            const tsConfigJson = getJsonFileContent(tree, 'tsconfig.json');
            expect(tsConfigJson.compilerOptions.paths.foo).toBeTruthy();
            expect(tsConfigJson.compilerOptions.paths.foo.length).toEqual(2);
            expect(tsConfigJson.compilerOptions.paths.foo[1]).toEqual('dist/foo');
        });
        it(`should not modify the file when --skipTsConfig`, () => {
            const tree = schematicRunner.runSchematic('library', {
                name: 'foo',
                skipTsConfig: true,
            }, workspaceTree);
            const tsConfigJson = getJsonFileContent(tree, 'tsconfig.json');
            expect(tsConfigJson.compilerOptions.paths).toBeUndefined();
        });
    });
    it('should generate inside of a library', () => {
        let tree = schematicRunner.runSchematic('library', defaultOptions, workspaceTree);
        const componentOptions = {
            name: 'comp',
            project: 'foo',
        };
        tree = schematicRunner.runSchematic('component', componentOptions, tree);
        expect(tree.exists('/projects/foo/src/lib/comp/comp.component.ts')).toBe(true);
    });
    it(`should support creating scoped libraries`, () => {
        const scopedName = '@myscope/mylib';
        const options = Object.assign({}, defaultOptions, { name: scopedName });
        const tree = schematicRunner.runSchematic('library', options, workspaceTree);
        const pkgJsonPath = '/projects/myscope/mylib/package.json';
        expect(tree.files).toContain(pkgJsonPath);
        expect(tree.files).toContain('/projects/myscope/mylib/src/lib/mylib.module.ts');
        expect(tree.files).toContain('/projects/myscope/mylib/src/lib/mylib.component.ts');
        const pkgJson = JSON.parse(tree.readContent(pkgJsonPath));
        expect(pkgJson.name).toEqual(scopedName);
        const tsConfigJson = JSON.parse(tree.readContent('/projects/myscope/mylib/tsconfig.spec.json'));
        expect(tsConfigJson.extends).toEqual('../../../tsconfig.json');
        const cfg = JSON.parse(tree.readContent('/angular.json'));
        expect(cfg.projects['@myscope/mylib']).toBeDefined();
        const rootTsCfg = JSON.parse(tree.readContent('/tsconfig.json'));
        expect(rootTsCfg.compilerOptions.paths['@myscope/mylib']).toEqual(['dist/myscope/mylib']);
    });
    it(`should dasherize scoped libraries`, () => {
        const scopedName = '@myScope/myLib';
        const expectedScopeName = '@my-scope/my-lib';
        const expectedFolderName = 'my-scope/my-lib';
        const options = Object.assign({}, defaultOptions, { name: scopedName });
        const tree = schematicRunner.runSchematic('library', options, workspaceTree);
        const pkgJsonPath = '/projects/my-scope/my-lib/package.json';
        expect(tree.readContent(pkgJsonPath)).toContain(expectedScopeName);
        const ngPkgJsonPath = '/projects/my-scope/my-lib/ng-package.json';
        expect(tree.readContent(ngPkgJsonPath)).toContain(expectedFolderName);
        const pkgJson = JSON.parse(tree.readContent(pkgJsonPath));
        expect(pkgJson.name).toEqual(expectedScopeName);
        const cfg = JSON.parse(tree.readContent('/angular.json'));
        expect(cfg.projects['@myScope/myLib']).toBeDefined();
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXhfc3BlYy5qcyIsInNvdXJjZVJvb3QiOiIvVXNlcnMvYm9iby9Xb3JrL3NoYXJrLXNjaGVtYXRpY3Mvc3JjLyIsInNvdXJjZXMiOlsic3JjL2xpYnJhcnkvaW5kZXhfc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7R0FNRztBQUNILGdFQUF1RjtBQUN2Riw2QkFBNkI7QUFFN0IsZ0VBQTREO0FBSTVELDRCQUE0QixJQUFrQixFQUFFLElBQVk7SUFDMUQsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUM1QyxDQUFDO0FBRUQsaUNBQWlDO0FBQ2pDLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsTUFBTSxlQUFlLEdBQUcsSUFBSSw2QkFBbUIsQ0FDN0Msd0JBQXdCLEVBQ3hCLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLG9CQUFvQixDQUFDLENBQzNDLENBQUM7SUFDRixNQUFNLGNBQWMsR0FBMEI7UUFDNUMsSUFBSSxFQUFFLEtBQUs7UUFDWCxTQUFTLEVBQUUsVUFBVTtRQUNyQixlQUFlLEVBQUUsS0FBSztRQUN0QixZQUFZLEVBQUUsS0FBSztLQUNwQixDQUFDO0lBQ0YsTUFBTSxnQkFBZ0IsR0FBcUI7UUFDekMsSUFBSSxFQUFFLFdBQVc7UUFDakIsY0FBYyxFQUFFLFVBQVU7UUFDMUIsT0FBTyxFQUFFLE9BQU87S0FDakIsQ0FBQztJQUVGLElBQUksYUFBMkIsQ0FBQztJQUNoQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsYUFBYSxHQUFHLGVBQWUsQ0FBQyxZQUFZLENBQUMsV0FBVyxFQUFFLGdCQUFnQixDQUFDLENBQUM7SUFDOUUsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO1FBQzdCLE1BQU0sSUFBSSxHQUFHLGVBQWUsQ0FBQyxZQUFZLENBQUMsU0FBUyxF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QixHQUFHLGlCQUFpQixDQUFDO1FBQzdDLE1BQU0sT0FBTyxxQkFBUSxjQUFjLElBQUUsSUFBSSxFQUFFLFVBQVUsR0FBRSxDQUFDO1FBQ3hELE1BQU0sSUFBSSxHQUFHLGVBQWUsQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFLE9BQU8sRUFBRSxhQUFhLENBQUMsQ0FBQztRQUU3RSxNQUFNLFdBQVcsR0FBRyx3Q0FBd0MsQ0FBQztRQUM3RCxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBRW5FLE1BQU0sYUFBYSxHQUFHLDJDQUEyQyxDQUFDO1FBQ2xFLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLGtCQUFrQixDQUFDLENBQUM7UUFFdEUsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7UUFDMUQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUVoRCxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztRQUMxRCxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDdkQsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCBHb29nbGUgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGFuIE1JVC1zdHlsZSBsaWNlbnNlIHRoYXQgY2FuIGJlXG4gKiBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGF0IGh0dHBzOi8vYW5ndWxhci5pby9saWNlbnNlXG4gKi9cbmltcG9ydCB7IFNjaGVtYXRpY1Rlc3RSdW5uZXIsIFVuaXRUZXN0VHJlZSB9IGZyb20gJ0Bhbmd1bGFyLWRldmtpdC9zY2hlbWF0aWNzL3Rlc3RpbmcnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IFNjaGVtYSBhcyBDb21wb25lbnRPcHRpb25zIH0gZnJvbSAnLi4vY29tcG9uZW50L3NjaGVtYSc7XG5pbXBvcnQgeyBsYXRlc3RWZXJzaW9ucyB9IGZyb20gJy4uL3V0aWxpdHkvbGF0ZXN0LXZlcnNpb25zJztcbmltcG9ydCB7IFNjaGVtYSBhcyBXb3Jrc3BhY2VPcHRpb25zIH0gZnJvbSAnLi4vd29ya3NwYWNlL3NjaGVtYSc7XG5pbXBvcnQgeyBTY2hlbWEgYXMgR2VuZXJhdGVMaWJyYXJ5U2NoZW1hIH0gZnJvbSAnLi9zY2hlbWEnO1xuXG5mdW5jdGlvbiBnZXRKc29uRmlsZUNvbnRlbnQodHJlZTogVW5pdFRlc3RUcmVlLCBwYXRoOiBzdHJpbmcpIHtcbiAgcmV0dXJuIEpTT04ucGFyc2UodHJlZS5yZWFkQ29udGVudChwYXRoKSk7XG59XG5cbi8vIHRzbGludDpkaXNhYmxlOm1heC1saW5lLWxlbmd0aFxuZGVzY3JpYmUoJ0xpYnJhcnkgU2NoZW1hdGljJywgKCkgPT4ge1xuICBjb25zdCBzY2hlbWF0aWNSdW5uZXIgPSBuZXcgU2NoZW1hdGljVGVzdFJ1bm5lcihcbiAgICAnQHNjaGVtYXRpY3MvbmdfcGFja2FncicsXG4gICAgcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL2NvbGxlY3Rpb24uanNvbicpLFxuICApO1xuICBjb25zdCBkZWZhdWx0T3B0aW9uczogR2VuZXJhdGVMaWJyYXJ5U2NoZW1hID0ge1xuICAgIG5hbWU6ICdmb28nLFxuICAgIGVudHJ5RmlsZTogJ215X2luZGV4JyxcbiAgICBza2lwUGFja2FnZUpzb246IGZhbHNlLFxuICAgIHNraXBUc0NvbmZpZzogZmFsc2UsXG4gIH07XG4gIGNvbnN0IHdvcmtzcGFjZU9wdGlvbnM6IFdvcmtzcGFjZU9wdGlvbnMgPSB7XG4gICAgbmFtZTogJ3dvcmtzcGFjZScsXG4gICAgbmV3UHJvamVjdFJvb3Q6ICdwcm9qZWN0cycsXG4gICAgdmVyc2lvbjogJzYuMC4wJyxcbiAgfTtcblxuICBsZXQgd29ya3NwYWNlVHJlZTogVW5pdFRlc3RUcmVlO1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICB3b3Jrc3BhY2VUcmVlID0gc2NoZW1hdGljUnVubmVyLnJ1blNjaGVtYXRpYygnd29ya3NwYWNlJywgd29ya3NwYWNlT3B0aW9ucyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgY3JlYXRlIGZpbGVzJywgKCkgPT4ge1xuICAgIGNvbnN0IHRyZWUgPSBzY2hlbWF0aWNSdW5uZXIucnVuU2NoZW1hdGljKCdsaWJyYXJ5JywgZGVmYXVsdE9wdGlvbnMsIHdvcmtzcGFjZVRyZWUpO1xuICAgIGNvbnN0IGZpbGVzID0gdHJlZS5maWxlcztcbiAgICBleHBlY3QoZmlsZXMuaW5kZXhPZignL3Byb2plY3RzL2Zvby9rYXJtYS5jb25mLmpzJykpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgZXhwZWN0KGZpbGVzLmluZGV4T2YoJy9wcm9qZWN0cy9mb28vbmctcGFja2FnZS5qc29uJykpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgZXhwZWN0KGZpbGVzLmluZGV4T2YoJy9wcm9qZWN0cy9mb28vcGFja2FnZS5qc29uJykpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgZXhwZWN0KGZpbGVzLmluZGV4T2YoJy9wcm9qZWN0cy9mb28vdHNsaW50Lmpzb24nKSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICBleHBlY3QoZmlsZXMuaW5kZXhPZignL3Byb2plY3RzL2Zvby9zcmMvdGVzdC50cycpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgIGV4cGVjdChmaWxlcy5pbmRleE9mKCcvcHJvamVjdHMvZm9vL3NyYy9teV9pbmRleC50cycpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgIGV4cGVjdChmaWxlcy5pbmRleE9mKCcvcHJvamVjdHMvZm9vL3NyYy9saWIvZm9vLm1vZHVsZS50cycpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgIGV4cGVjdChmaWxlcy5pbmRleE9mKCcvcHJvamVjdHMvZm9vL3NyYy9saWIvZm9vLmNvbXBvbmVudC5zcGVjLnRzJykpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgZXhwZWN0KGZpbGVzLmluZGV4T2YoJy9wcm9qZWN0cy9mb28vc3JjL2xpYi9mb28uY29tcG9uZW50LnRzJykpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgZXhwZWN0KGZpbGVzLmluZGV4T2YoJy9wcm9qZWN0cy9mb28vc3JjL2xpYi9mb28uc2VydmljZS5zcGVjLnRzJykpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgZXhwZWN0KGZpbGVzLmluZGV4T2YoJy9wcm9qZWN0cy9mb28vc3JjL2xpYi9mb28uc2VydmljZS50cycpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICB9KTtcblxuXG4gIGl0KCdzaG91bGQgY3JlYXRlIGEgdHNjb25maWcgZm9yIGxpYnJhcnknLCAoKSA9PiB7XG4gICAgY29uc3QgdHJlZSA9IHNjaGVtYXRpY1J1bm5lci5ydW5TY2hlbWF0aWMoJ2xpYnJhcnknLCBkZWZhdWx0T3B0aW9ucywgd29ya3NwYWNlVHJlZSk7XG4gICAgY29uc3QgZmlsZUNvbnRlbnQgPSBnZXRKc29uRmlsZUNvbnRlbnQodHJlZSwgJy9wcm9qZWN0cy9mb28vdHNjb25maWcubGliLmpzb24nKTtcbiAgICBleHBlY3QoZmlsZUNvbnRlbnQpLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgY3JlYXRlIGEgbmctcGFja2FnZS5qc29uIHdpdGggbmdQYWNrYWdlIGNvbmYnLCAoKSA9PiB7XG4gICAgY29uc3QgdHJlZSA9IHNjaGVtYXRpY1J1bm5lci5ydW5TY2hlbWF0aWMoJ2xpYnJhcnknLCBkZWZhdWx0T3B0aW9ucywgd29ya3NwYWNlVHJlZSk7XG4gICAgY29uc3QgZmlsZUNvbnRlbnQgPSBnZXRKc29uRmlsZUNvbnRlbnQodHJlZSwgJy9wcm9qZWN0cy9mb28vbmctcGFja2FnZS5qc29uJyk7XG4gICAgZXhwZWN0KGZpbGVDb250ZW50LmxpYikudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3QoZmlsZUNvbnRlbnQubGliLmVudHJ5RmlsZSkudG9FcXVhbCgnc3JjL215X2luZGV4LnRzJyk7XG4gICAgZXhwZWN0KGZpbGVDb250ZW50LmRlbGV0ZURlc3RQYXRoKS50b0VxdWFsKGZhbHNlKTtcbiAgICBleHBlY3QoZmlsZUNvbnRlbnQuZGVzdCkudG9FcXVhbCgnLi4vLi4vZGlzdC9mb28nKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCB1c2UgZGVmYXVsdCB2YWx1ZSBmb3IgYmFzZURpciBhbmQgZW50cnlGaWxlJywgKCkgPT4ge1xuICAgIGNvbnN0IHRyZWUgPSBzY2hlbWF0aWNSdW5uZXIucnVuU2NoZW1hdGljKCdsaWJyYXJ5Jywge1xuICAgICAgbmFtZTogJ2Zvb2JhcicsXG4gICAgfSwgd29ya3NwYWNlVHJlZSk7XG4gICAgZXhwZWN0KHRyZWUuZmlsZXMuaW5kZXhPZignL3Byb2plY3RzL2Zvb2Jhci9zcmMvcHVibGljX2FwaS50cycpKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICB9KTtcblxuICBpdChgc2hvdWxkIGFkZCBsaWJyYXJ5IHRvIHdvcmtzcGFjZWAsICgpID0+IHtcbiAgICBjb25zdCB0cmVlID0gc2NoZW1hdGljUnVubmVyLnJ1blNjaGVtYXRpYygnbGlicmFyeScsIGRlZmF1bHRPcHRpb25zLCB3b3Jrc3BhY2VUcmVlKTtcblxuICAgIGNvbnN0IHdvcmtzcGFjZSA9IGdldEpzb25GaWxlQ29udGVudCh0cmVlLCAnL2FuZ3VsYXIuanNvbicpO1xuICAgIGV4cGVjdCh3b3Jrc3BhY2UucHJvamVjdHMuZm9vKS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdCh3b3Jrc3BhY2UuZGVmYXVsdFByb2plY3QpLnRvQmUoJ2ZvbycpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHNldCB0aGUgcHJlZml4IHRvIGxpYiBpZiBub25lIGlzIHNldCcsICgpID0+IHtcbiAgICBjb25zdCB0cmVlID0gc2NoZW1hdGljUnVubmVyLnJ1blNjaGVtYXRpYygnbGlicmFyeScsIGRlZmF1bHRPcHRpb25zLCB3b3Jrc3BhY2VUcmVlKTtcblxuICAgIGNvbnN0IHdvcmtzcGFjZSA9IEpTT04ucGFyc2UodHJlZS5yZWFkQ29udGVudCgnL2FuZ3VsYXIuanNvbicpKTtcbiAgICBleHBlY3Qod29ya3NwYWNlLnByb2plY3RzLmZvby5wcmVmaXgpLnRvRXF1YWwoJ2xpYicpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHNldCB0aGUgcHJlZml4IGNvcnJlY3RseScsICgpID0+IHtcbiAgICBjb25zdCBvcHRpb25zID0geyAuLi5kZWZhdWx0T3B0aW9ucywgcHJlZml4OiAncHJlJyB9O1xuICAgIGNvbnN0IHRyZWUgPSBzY2hlbWF0aWNSdW5uZXIucnVuU2NoZW1hdGljKCdsaWJyYXJ5Jywgb3B0aW9ucywgd29ya3NwYWNlVHJlZSk7XG5cbiAgICBjb25zdCB3b3Jrc3BhY2UgPSBKU09OLnBhcnNlKHRyZWUucmVhZENvbnRlbnQoJy9hbmd1bGFyLmpzb24nKSk7XG4gICAgZXhwZWN0KHdvcmtzcGFjZS5wcm9qZWN0cy5mb28ucHJlZml4KS50b0VxdWFsKCdwcmUnKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBoYW5kbGUgYSBwYXNjYWxDYXNlZE5hbWUnLCAoKSA9PiB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHsgLi4uZGVmYXVsdE9wdGlvbnMsIG5hbWU6ICdwYXNjYWxDYXNlZE5hbWUnIH07XG4gICAgY29uc3QgdHJlZSA9IHNjaGVtYXRpY1J1bm5lci5ydW5TY2hlbWF0aWMoJ2xpYnJhcnknLCBvcHRpb25zLCB3b3Jrc3BhY2VUcmVlKTtcbiAgICBjb25zdCBjb25maWcgPSBnZXRKc29uRmlsZUNvbnRlbnQodHJlZSwgJy9hbmd1bGFyLmpzb24nKTtcbiAgICBjb25zdCBwcm9qZWN0ID0gY29uZmlnLnByb2plY3RzLnBhc2NhbENhc2VkTmFtZTtcbiAgICBleHBlY3QocHJvamVjdCkudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3QocHJvamVjdC5yb290KS50b0VxdWFsKCdwcm9qZWN0cy9wYXNjYWwtY2FzZWQtbmFtZScpO1xuICAgIGNvbnN0IHN2Y0NvbnRlbnQgPSB0cmVlLnJlYWRDb250ZW50KCcvcHJvamVjdHMvcGFzY2FsLWNhc2VkLW5hbWUvc3JjL2xpYi9wYXNjYWwtY2FzZWQtbmFtZS5zZXJ2aWNlLnRzJyk7XG4gICAgZXhwZWN0KHN2Y0NvbnRlbnQpLnRvTWF0Y2goL3Byb3ZpZGVkSW46ICdyb290Jy8pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIHNldCB0aGUgcmlnaHQgcGF0aCBhbmQgcHJlZml4IGluIHRoZSB0c2xpbnQgZmlsZScsICgpID0+IHtcbiAgICBjb25zdCB0cmVlID0gc2NoZW1hdGljUnVubmVyLnJ1blNjaGVtYXRpYygnbGlicmFyeScsIGRlZmF1bHRPcHRpb25zLCB3b3Jrc3BhY2VUcmVlKTtcbiAgICBjb25zdCBwYXRoID0gJy9wcm9qZWN0cy9mb28vdHNsaW50Lmpzb24nO1xuICAgIGNvbnN0IGNvbnRlbnQgPSBKU09OLnBhcnNlKHRyZWUucmVhZENvbnRlbnQocGF0aCkpO1xuICAgIGV4cGVjdChjb250ZW50LmV4dGVuZHMpLnRvTWF0Y2goJy4uLy4uL3RzbGludC5qc29uJyk7XG4gICAgZXhwZWN0KGNvbnRlbnQucnVsZXNbJ2RpcmVjdGl2ZS1zZWxlY3RvciddWzJdKS50b01hdGNoKCdsaWInKTtcbiAgICBleHBlY3QoY29udGVudC5ydWxlc1snY29tcG9uZW50LXNlbGVjdG9yJ11bMl0pLnRvTWF0Y2goJ2xpYicpO1xuICB9KTtcblxuICBkZXNjcmliZShgdXBkYXRlIHBhY2thZ2UuanNvbmAsICgpID0+IHtcbiAgICBpdChgc2hvdWxkIGFkZCBuZy1wYWNrYWdyIHRvIGRldkRlcGVuZGVuY2llc2AsICgpID0+IHtcbiAgICAgIGNvbnN0IHRyZWUgPSBzY2hlbWF0aWNSdW5uZXIucnVuU2NoZW1hdGljKCdsaWJyYXJ5JywgZGVmYXVsdE9wdGlvbnMsIHdvcmtzcGFjZVRyZWUpO1xuXG4gICAgICBjb25zdCBwYWNrYWdlSnNvbiA9IGdldEpzb25GaWxlQ29udGVudCh0cmVlLCAncGFja2FnZS5qc29uJyk7XG4gICAgICBleHBlY3QocGFja2FnZUpzb24uZGV2RGVwZW5kZW5jaWVzWyduZy1wYWNrYWdyJ10pLnRvRXF1YWwoJ14zLjAuMCcpO1xuICAgICAgZXhwZWN0KHBhY2thZ2VKc29uLmRldkRlcGVuZGVuY2llc1snQGFuZ3VsYXItZGV2a2l0L2J1aWxkLW5nLXBhY2thZ3InXSlcbiAgICAgICAgLnRvRXF1YWwobGF0ZXN0VmVyc2lvbnMuRGV2a2l0QnVpbGROZ1BhY2thZ3IpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgdGhlIGxhdGVzdCBrbm93biB2ZXJzaW9ucyBpbiBwYWNrYWdlLmpzb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCB0cmVlID0gc2NoZW1hdGljUnVubmVyLnJ1blNjaGVtYXRpYygnbGlicmFyeScsIGRlZmF1bHRPcHRpb25zLCB3b3Jrc3BhY2VUcmVlKTtcbiAgICAgIGNvbnN0IHBrZyA9IEpTT04ucGFyc2UodHJlZS5yZWFkQ29udGVudCgnL3BhY2thZ2UuanNvbicpKTtcbiAgICAgIGV4cGVjdChwa2cuZGV2RGVwZW5kZW5jaWVzWydAYW5ndWxhci9jb21waWxlci1jbGknXSkudG9FcXVhbChsYXRlc3RWZXJzaW9ucy5Bbmd1bGFyKTtcbiAgICAgIGV4cGVjdChwa2cuZGV2RGVwZW5kZW5jaWVzWyd0eXBlc2NyaXB0J10pLnRvRXF1YWwobGF0ZXN0VmVyc2lvbnMuVHlwZVNjcmlwdCk7XG4gICAgfSk7XG5cbiAgICBpdChgc2hvdWxkIG5vdCBvdmVycmlkZSBleGlzdGluZyB1c2VycyBkZXBlbmRlbmNpZXNgLCAoKSA9PiB7XG4gICAgICBjb25zdCBvbGRQYWNrYWdlSnNvbiA9IHdvcmtzcGFjZVRyZWUucmVhZENvbnRlbnQoJ3BhY2thZ2UuanNvbicpO1xuICAgICAgd29ya3NwYWNlVHJlZS5vdmVyd3JpdGUoJ3BhY2thZ2UuanNvbicsIG9sZFBhY2thZ2VKc29uLnJlcGxhY2UoXG4gICAgICAgIGBcInR5cGVzY3JpcHRcIjogXCIke2xhdGVzdFZlcnNpb25zLlR5cGVTY3JpcHR9XCJgLFxuICAgICAgICBgXCJ0eXBlc2NyaXB0XCI6IFwifjIuNS4yXCJgLFxuICAgICAgKSk7XG5cbiAgICAgIGNvbnN0IHRyZWUgPSBzY2hlbWF0aWNSdW5uZXIucnVuU2NoZW1hdGljKCdsaWJyYXJ5JywgZGVmYXVsdE9wdGlvbnMsIHdvcmtzcGFjZVRyZWUpO1xuICAgICAgY29uc3QgcGFja2FnZUpzb24gPSBnZXRKc29uRmlsZUNvbnRlbnQodHJlZSwgJ3BhY2thZ2UuanNvbicpO1xuICAgICAgZXhwZWN0KHBhY2thZ2VKc29uLmRldkRlcGVuZGVuY2llcy50eXBlc2NyaXB0KS50b0VxdWFsKCd+Mi41LjInKTtcbiAgICB9KTtcblxuICAgIGl0KGBzaG91bGQgbm90IG1vZGlmeSB0aGUgZmlsZSB3aGVuIC0tc2tpcFBhY2thZ2VKc29uYCwgKCkgPT4ge1xuICAgICAgY29uc3QgdHJlZSA9IHNjaGVtYXRpY1J1bm5lci5ydW5TY2hlbWF0aWMoJ2xpYnJhcnknLCB7XG4gICAgICAgIG5hbWU6ICdmb28nLFxuICAgICAgICBza2lwUGFja2FnZUpzb246IHRydWUsXG4gICAgICB9LCB3b3Jrc3BhY2VUcmVlKTtcblxuICAgICAgY29uc3QgcGFja2FnZUpzb24gPSBnZXRKc29uRmlsZUNvbnRlbnQodHJlZSwgJ3BhY2thZ2UuanNvbicpO1xuICAgICAgZXhwZWN0KHBhY2thZ2VKc29uLmRldkRlcGVuZGVuY2llc1snbmctcGFja2FnciddKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICBleHBlY3QocGFja2FnZUpzb24uZGV2RGVwZW5kZW5jaWVzWydAYW5ndWxhci1kZXZraXQvYnVpbGQtYW5ndWxhciddKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKGB1cGRhdGUgdHNjb25maWcuanNvbmAsICgpID0+IHtcbiAgICBpdChgc2hvdWxkIGFkZCBwYXRocyBtYXBwaW5nIHRvIGVtcHR5IHRzY29uZmlnYCwgKCkgPT4ge1xuICAgICAgY29uc3QgdHJlZSA9IHNjaGVtYXRpY1J1bm5lci5ydW5TY2hlbWF0aWMoJ2xpYnJhcnknLCBkZWZhdWx0T3B0aW9ucywgd29ya3NwYWNlVHJlZSk7XG5cbiAgICAgIGNvbnN0IHRzQ29uZmlnSnNvbiA9IGdldEpzb25GaWxlQ29udGVudCh0cmVlLCAndHNjb25maWcuanNvbicpO1xuICAgICAgZXhwZWN0KHRzQ29uZmlnSnNvbi5jb21waWxlck9wdGlvbnMucGF0aHMuZm9vKS50b0JlVHJ1dGh5KCk7XG4gICAgICBleHBlY3QodHNDb25maWdKc29uLmNvbXBpbGVyT3B0aW9ucy5wYXRocy5mb28ubGVuZ3RoKS50b0VxdWFsKDEpO1xuICAgICAgZXhwZWN0KHRzQ29uZmlnSnNvbi5jb21waWxlck9wdGlvbnMucGF0aHMuZm9vWzBdKS50b0VxdWFsKCdkaXN0L2ZvbycpO1xuICAgICAgZXhwZWN0KHRzQ29uZmlnSnNvbi5jb21waWxlck9wdGlvbnMucGF0aHNbJ2Zvby8qJ10pLnRvQmVUcnV0aHkoKTtcbiAgICAgIGV4cGVjdCh0c0NvbmZpZ0pzb24uY29tcGlsZXJPcHRpb25zLnBhdGhzWydmb28vKiddLmxlbmd0aCkudG9FcXVhbCgxKTtcbiAgICAgIGV4cGVjdCh0c0NvbmZpZ0pzb24uY29tcGlsZXJPcHRpb25zLnBhdGhzWydmb28vKiddWzBdKS50b0VxdWFsKCdkaXN0L2Zvby8qJyk7XG4gICAgfSk7XG5cbiAgICBpdChgc2hvdWxkIGFwcGVuZCB0byBleGlzdGluZyBwYXRocyBtYXBwaW5nc2AsICgpID0+IHtcbiAgICAgIHdvcmtzcGFjZVRyZWUub3ZlcndyaXRlKCd0c2NvbmZpZy5qc29uJywgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBjb21waWxlck9wdGlvbnM6IHtcbiAgICAgICAgICBwYXRoczoge1xuICAgICAgICAgICAgJ3VucmVsYXRlZCc6IFsnLi9zb21ldGhpbmcvZWxzZS50cyddLFxuICAgICAgICAgICAgJ2Zvbyc6IFsnbGlicy8qJ10sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pKTtcbiAgICAgIGNvbnN0IHRyZWUgPSBzY2hlbWF0aWNSdW5uZXIucnVuU2NoZW1hdGljKCdsaWJyYXJ5JywgZGVmYXVsdE9wdGlvbnMsIHdvcmtzcGFjZVRyZWUpO1xuXG4gICAgICBjb25zdCB0c0NvbmZpZ0pzb24gPSBnZXRKc29uRmlsZUNvbnRlbnQodHJlZSwgJ3RzY29uZmlnLmpzb24nKTtcbiAgICAgIGV4cGVjdCh0c0NvbmZpZ0pzb24uY29tcGlsZXJPcHRpb25zLnBhdGhzLmZvbykudG9CZVRydXRoeSgpO1xuICAgICAgZXhwZWN0KHRzQ29uZmlnSnNvbi5jb21waWxlck9wdGlvbnMucGF0aHMuZm9vLmxlbmd0aCkudG9FcXVhbCgyKTtcbiAgICAgIGV4cGVjdCh0c0NvbmZpZ0pzb24uY29tcGlsZXJPcHRpb25zLnBhdGhzLmZvb1sxXSkudG9FcXVhbCgnZGlzdC9mb28nKTtcbiAgICB9KTtcblxuICAgIGl0KGBzaG91bGQgbm90IG1vZGlmeSB0aGUgZmlsZSB3aGVuIC0tc2tpcFRzQ29uZmlnYCwgKCkgPT4ge1xuICAgICAgY29uc3QgdHJlZSA9IHNjaGVtYXRpY1J1bm5lci5ydW5TY2hlbWF0aWMoJ2xpYnJhcnknLCB7XG4gICAgICAgIG5hbWU6ICdmb28nLFxuICAgICAgICBza2lwVHNDb25maWc6IHRydWUsXG4gICAgICB9LCB3b3Jrc3BhY2VUcmVlKTtcblxuICAgICAgY29uc3QgdHNDb25maWdKc29uID0gZ2V0SnNvbkZpbGVDb250ZW50KHRyZWUsICd0c2NvbmZpZy5qc29uJyk7XG4gICAgICBleHBlY3QodHNDb25maWdKc29uLmNvbXBpbGVyT3B0aW9ucy5wYXRocykudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGdlbmVyYXRlIGluc2lkZSBvZiBhIGxpYnJhcnknLCAoKSA9PiB7XG4gICAgbGV0IHRyZWUgPSBzY2hlbWF0aWNSdW5uZXIucnVuU2NoZW1hdGljKCdsaWJyYXJ5JywgZGVmYXVsdE9wdGlvbnMsIHdvcmtzcGFjZVRyZWUpO1xuICAgIGNvbnN0IGNvbXBvbmVudE9wdGlvbnM6IENvbXBvbmVudE9wdGlvbnMgPSB7XG4gICAgICBuYW1lOiAnY29tcCcsXG4gICAgICBwcm9qZWN0OiAnZm9vJyxcbiAgICB9O1xuICAgIHRyZWUgPSBzY2hlbWF0aWNSdW5uZXIucnVuU2NoZW1hdGljKCdjb21wb25lbnQnLCBjb21wb25lbnRPcHRpb25zLCB0cmVlKTtcbiAgICBleHBlY3QodHJlZS5leGlzdHMoJy9wcm9qZWN0cy9mb28vc3JjL2xpYi9jb21wL2NvbXAuY29tcG9uZW50LnRzJykpLnRvQmUodHJ1ZSk7XG4gIH0pO1xuXG4gIGl0KGBzaG91bGQgc3VwcG9ydCBjcmVhdGluZyBzY29wZWQgbGlicmFyaWVzYCwgKCkgPT4ge1xuICAgIGNvbnN0IHNjb3BlZE5hbWUgPSAnQG15c2NvcGUvbXlsaWInO1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7IC4uLmRlZmF1bHRPcHRpb25zLCBuYW1lOiBzY29wZWROYW1lIH07XG4gICAgY29uc3QgdHJlZSA9IHNjaGVtYXRpY1J1bm5lci5ydW5TY2hlbWF0aWMoJ2xpYnJhcnknLCBvcHRpb25zLCB3b3Jrc3BhY2VUcmVlKTtcblxuICAgIGNvbnN0IHBrZ0pzb25QYXRoID0gJy9wcm9qZWN0cy9teXNjb3BlL215bGliL3BhY2thZ2UuanNvbic7XG4gICAgZXhwZWN0KHRyZWUuZmlsZXMpLnRvQ29udGFpbihwa2dKc29uUGF0aCk7XG4gICAgZXhwZWN0KHRyZWUuZmlsZXMpLnRvQ29udGFpbignL3Byb2plY3RzL215c2NvcGUvbXlsaWIvc3JjL2xpYi9teWxpYi5tb2R1bGUudHMnKTtcbiAgICBleHBlY3QodHJlZS5maWxlcykudG9Db250YWluKCcvcHJvamVjdHMvbXlzY29wZS9teWxpYi9zcmMvbGliL215bGliLmNvbXBvbmVudC50cycpO1xuXG4gICAgY29uc3QgcGtnSnNvbiA9IEpTT04ucGFyc2UodHJlZS5yZWFkQ29udGVudChwa2dKc29uUGF0aCkpO1xuICAgIGV4cGVjdChwa2dKc29uLm5hbWUpLnRvRXF1YWwoc2NvcGVkTmFtZSk7XG5cbiAgICBjb25zdCB0c0NvbmZpZ0pzb24gPSBKU09OLnBhcnNlKHRyZWUucmVhZENvbnRlbnQoJy9wcm9qZWN0cy9teXNjb3BlL215bGliL3RzY29uZmlnLnNwZWMuanNvbicpKTtcbiAgICBleHBlY3QodHNDb25maWdKc29uLmV4dGVuZHMpLnRvRXF1YWwoJy4uLy4uLy4uL3RzY29uZmlnLmpzb24nKTtcblxuICAgIGNvbnN0IGNmZyA9IEpTT04ucGFyc2UodHJlZS5yZWFkQ29udGVudCgnL2FuZ3VsYXIuanNvbicpKTtcbiAgICBleHBlY3QoY2ZnLnByb2plY3RzWydAbXlzY29wZS9teWxpYiddKS50b0JlRGVmaW5lZCgpO1xuXG4gICAgY29uc3Qgcm9vdFRzQ2ZnID0gSlNPTi5wYXJzZSh0cmVlLnJlYWRDb250ZW50KCcvdHNjb25maWcuanNvbicpKTtcbiAgICBleHBlY3Qocm9vdFRzQ2ZnLmNvbXBpbGVyT3B0aW9ucy5wYXRoc1snQG15c2NvcGUvbXlsaWInXSkudG9FcXVhbChbJ2Rpc3QvbXlzY29wZS9teWxpYiddKTtcbiAgfSk7XG5cbiAgaXQoYHNob3VsZCBkYXNoZXJpemUgc2NvcGVkIGxpYnJhcmllc2AsICgpID0+IHtcbiAgICBjb25zdCBzY29wZWROYW1lID0gJ0BteVNjb3BlL215TGliJztcbiAgICBjb25zdCBleHBlY3RlZFNjb3BlTmFtZSA9ICdAbXktc2NvcGUvbXktbGliJztcbiAgICBjb25zdCBleHBlY3RlZEZvbGRlck5hbWUgPSAnbXktc2NvcGUvbXktbGliJztcbiAgICBjb25zdCBvcHRpb25zID0geyAuLi5kZWZhdWx0T3B0aW9ucywgbmFtZTogc2NvcGVkTmFtZSB9O1xuICAgIGNvbnN0IHRyZWUgPSBzY2hlbWF0aWNSdW5uZXIucnVuU2NoZW1hdGljKCdsaWJyYXJ5Jywgb3B0aW9ucywgd29ya3NwYWNlVHJlZSk7XG5cbiAgICBjb25zdCBwa2dKc29uUGF0aCA9ICcvcHJvamVjdHMvbXktc2NvcGUvbXktbGliL3BhY2thZ2UuanNvbic7XG4gICAgZXhwZWN0KHRyZWUucmVhZENvbnRlbnQocGtnSnNvblBhdGgpKS50b0NvbnRhaW4oZXhwZWN0ZWRTY29wZU5hbWUpO1xuXG4gICAgY29uc3QgbmdQa2dKc29uUGF0aCA9ICcvcHJvamVjdHMvbXktc2NvcGUvbXktbGliL25nLXBhY2thZ2UuanNvbic7XG4gICAgZXhwZWN0KHRyZWUucmVhZENvbnRlbnQobmdQa2dKc29uUGF0aCkpLnRvQ29udGFpbihleHBlY3RlZEZvbGRlck5hbWUpO1xuXG4gICAgY29uc3QgcGtnSnNvbiA9IEpTT04ucGFyc2UodHJlZS5yZWFkQ29udGVudChwa2dKc29uUGF0aCkpO1xuICAgIGV4cGVjdChwa2dKc29uLm5hbWUpLnRvRXF1YWwoZXhwZWN0ZWRTY29wZU5hbWUpO1xuXG4gICAgY29uc3QgY2ZnID0gSlNPTi5wYXJzZSh0cmVlLnJlYWRDb250ZW50KCcvYW5ndWxhci5qc29uJykpO1xuICAgIGV4cGVjdChjZmcucHJvamVjdHNbJ0BteVNjb3BlL215TGliJ10pLnRvQmVEZWZpbmVkKCk7XG4gIH0pO1xufSk7XG4iXX0=